<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <%- include('../partials/head') %>
    <title>Minhas Contas - Finansave</title>
</head>
<body>
    <%- include('../partials/navbar') %>

    <div class="container py-4">
        <!-- Cabeçalho com Saldo Total -->
        <div class="accounts-header">
            <h1 class="h3 mb-4">Minhas Contas</h1>
            <p class="mb-2">Saldo Total</p>
            <div class="total-balance <%= saldoTotal < 0 ? 'text-danger' : 'text-success' %>">
                <%= new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(saldoTotal) %>
            </div>
        </div>

        <%- include('../partials/messages') %>

        <!-- Botão Adicionar Conta -->
        <div class="mb-4 text-end">
            <a href="/contas/criar" class="btn btn-primary">
                <i class="fas fa-plus"></i> Nova Conta
            </a>
        </div>

        <!-- Lista de Contas -->
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            <% contas.forEach(function(conta) { %>
                <div class="col">
                    <div class="card account-card h-100">
                        <!-- Status da Conta -->
                        <div class="account-status">
                            <% if(conta.ativa) { %>
                                <span class="badge bg-success">Ativa</span>
                            <% } else { %>
                                <span class="badge bg-secondary">Inativa</span>
                            <% } %>
                        </div>

                        <div class="card-body">
                            <!-- Nome e Tipo da Conta -->
                            <h5 class="card-title mb-1"><%= conta.nome %></h5>
                            <p class="account-type mb-3">
                                <i class="fas fa-wallet"></i> <%= conta.tipo %>
                            </p>

                            <!-- Saldo -->
                            <p class="account-balance mb-2 <%= conta.saldo_atual < 0 ? 'text-danger' : 'text-success' %>">
                                <%= new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(conta.saldo_atual) %>
                            </p>

                            <!-- Instituição -->
                            <% if(conta.instituicao) { %>
                                <p class="account-institution mb-3">
                                    <i class="fas fa-university"></i> <%= conta.instituicao %>
                                </p>
                            <% } %>

                            <!-- Ações -->
                            <div class="account-actions">
                                <div class="btn-group w-100" role="group">
                                    <a href="/contas/editar/<%= conta.conta_id %>" class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-edit"></i> Editar
                                    </a>
                                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="confirmarExclusao('<%= conta.conta_id %>', '<%= conta.nome %>')">
                                        <i class="fas fa-trash"></i> Excluir
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <% }); %>

            <% if(contas.length === 0) { %>
                <div class="col-12">
                    <div class="text-center py-5">
                        <i class="fas fa-wallet fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">Nenhuma conta cadastrada</h4>
                        <p class="text-muted">Comece criando sua primeira conta bancária.</p>
                        <a href="/contas/criar" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Criar Primeira Conta
                        </a>
                    </div>
                </div>
            <% } %>
        </div>
    </div>

    <%- include('../partials/footer') %>

    <script>
        function confirmarExclusao(contaId, nomeConta) {
            if (confirm(`Tem certeza que deseja excluir a conta "${nomeConta}"? Esta ação não pode ser desfeita.`)) {
                // Criar formulário para enviar DELETE
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/contas/excluir/${contaId}`;
                
                const methodInput = document.createElement('input');
                methodInput.type = 'hidden';
                methodInput.name = '_method';
                methodInput.value = 'DELETE';
                form.appendChild(methodInput);
                
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
</body>
</html>